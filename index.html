<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Birthday Card</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
    <style>
      * { box-sizing: border-box; }
      :root { --card-w: 640px; --card-h: 400px; }

      body {
        margin: 0;
        font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: linear-gradient(135deg, #ff9a9e, #fad0c4, #fbc2eb, #a6c0fe, #fddb92);
        background-size: 400% 400%;
        animation: bgShift 16s ease-in-out infinite;
        min-height: 100svh;
        display: grid;
        place-items: center;
      }
      @keyframes bgShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

      .card { width: var(--card-w); height: var(--card-h); position: relative; perspective: 1200px; transition: transform .8s ease; user-select: none; }
      .card:not(.open):hover { transform: rotate(-3deg); }

      .outside, .inside { position: absolute; top: 0; bottom: 0; width: 50%; left: 50%; height: 100%; }
      .inside { background: linear-gradient(to right, #e7e7e7, #ffffff 30%); padding: 16px 20px; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 12px; }

      .outside { transform-style: preserve-3d; transform-origin: left; transition: transform 1.2s ease; cursor: pointer; z-index: 2; }
      .front, .back { position: absolute; inset: 0; backface-visibility: hidden; -webkit-backface-visibility: hidden; }
      .front { background: #fff; display: grid; place-items: center; padding: 20px; }
      .back  { transform: rotateY(180deg); background: linear-gradient(to left, #e7e7e7, #ffffff 30%); }

      .title { font-size: 26px; letter-spacing: 6px; text-transform: uppercase; color: #000046; margin: 0 0 6px; }

      .cake { position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 20px auto; }
      .top-layer, .middle-layer, .bottom-layer { height: 80px; width: 240px; background-repeat: repeat; background-size: 60px 100px; background-position: 28px 0; background-image: linear-gradient(transparent 50px, #fedbab 50px, #fedbab 60px, transparent 60px), radial-gradient(circle at 30px 5px, #994c10 30px, #fcbf29 31px); border-radius: 10px 10px 0 0; position: relative; margin: auto; }
      .middle-layer { transform: scale(0.85); top: 6px; }
      .top-layer { transform: scale(0.7); top: 26px; }
      .candle { height: 45px; width: 15px; background: repeating-linear-gradient(45deg, #fd3018 0, #fd3018 5px, #ffa89e 5px, #ffa89e 10px); position: absolute; top: -45px; left: 50%; transform: translateX(-50%); }
      .candle::before { content: ""; position: absolute; height: 16px; width: 16px; background: #ffa500; border-radius: 0 50% 50% 50%; bottom: 48px; transform: rotate(45deg); left: -1px; }

      .card.open .outside { transform: rotateY(-130deg); }

      .msg { font-size: 18px; color: #1a1a1a; margin: 0; }

      /* photo area â€” square inside card, becomes circular on pop */
      .photo-wrap { width: 220px; height: 220px; border-radius: 18px; overflow: hidden; background: #fff; margin: 0 auto; display:flex;align-items:center;justify-content:center; cursor: pointer; transition: all .6s ease; }
      .photo-wrap img { width: 100%; height: 100%; object-fit: cover; object-position: center 40%; display: block; }

      /* popped style + bounceTwirl animation (doesn't spin image itself) */
      .photo-wrap.popped { position: fixed; width: 300px; height: 300px; border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(1.1); z-index: 10000; box-shadow: 0 12px 25px rgba(0,0,0,.3); animation: bounceTwirl 3s ease-in-out infinite; transform-origin: center center; }

      /* spin the image itself to emulate a CD while the container bounces/twirls */
      .photo-wrap.popped img { animation: spinSlow 6s linear infinite; }

      /* small center white circle to look like CD hole */
      .photo-wrap.popped::after { content: ""; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 18%; height: 18%; background: #fff; border-radius: 50%; box-shadow: inset 0 2px 4px rgba(0,0,0,0.14); pointer-events: none; }

      @keyframes spinSlow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

      @keyframes bounceTwirl {
        0%   { transform: translate(-50%, -50%) translateY(0) rotate(0deg) scale(1.08); }
        12.5%{ transform: translate(-50%, -60%) translateY(-8px) rotate(90deg) scale(1.12); }
        25%  { transform: translate(-50%, -50%) translateY(0) rotate(180deg) scale(1.06); }
        37.5%{ transform: translate(-50%, -60%) translateY(-6px) rotate(270deg) scale(1.1); }
        50%  { transform: translate(-50%, -50%) translateY(0) rotate(360deg) scale(1.08); }
        62.5%{ transform: translate(-50%, -60%) translateY(-6px) rotate(450deg) scale(1.11); }
        75%  { transform: translate(-50%, -50%) translateY(0) rotate(540deg) scale(1.07); }
        87.5%{ transform: translate(-50%, -60%) translateY(-5px) rotate(630deg) scale(1.09); }
        100% { transform: translate(-50%, -50%) translateY(0) rotate(720deg) scale(1.08); }
      }

      body.disco { animation: discoFlash 1.2s linear infinite; background: linear-gradient(45deg, #ff004c, #00e1ff, #52ff00, #ffea00, #b200ff); background-size: 400% 400%; }
      @keyframes discoFlash { 0% { background-position: 0% 50%; } 25% { background-position: 50% 50%; } 50% { background-position: 100% 50%; } 75% { background-position: 50% 50%; } 100% { background-position: 0% 50%; } }

      @media (max-width: 720px) { :root { --card-w: 92vw; --card-h: 58vh; } .photo-wrap { width: 170px; height: 170px; } .photo-wrap.popped { width: 220px; height: 220px; } }
    </style>
  </head>
  <body>
    <div class="card" id="card">
      <div class="outside" id="outside" aria-label="Open birthday card" role="button" tabindex="0">
        <div class="front">
          <div style="text-align:center; width:100%; position: relative;">
            <h2 class="title">Happy Birthday</h2>
            <div class="cake">
              <div class="candle"></div>
              <div class="top-layer"></div>
              <div class="middle-layer"></div>
              <div class="bottom-layer"></div>
            </div>
            <p class="hint">Click to open ðŸŽ‰</p>
          </div>
        </div>
        <div class="back"></div>
      </div>

      <div class="inside">
        <div class="photo-wrap" id="photoWrap">
          <img id="friendPhoto" src="hanspookie.png" alt="Happy Birthday!" />
        </div>
        <p class="msg">Wishing you a day filled with love, laughter, and all your favorite things.</p>
      </div>
    </div>

    <audio id="bgMusic" src="audio.mp3" preload="auto"></audio>

    <script>
      (function(){
        const card    = document.getElementById('card');
        const outside = document.getElementById('outside');
        const music   = document.getElementById('bgMusic');
        const photo   = document.getElementById('photoWrap');
        const body    = document.body;

        function toggleCard() {
          if (!card.classList.contains('open')) {
            card.classList.add('open');
          } else {
            card.classList.remove('open');
            photo.classList.remove('popped');
            body.classList.remove('disco');
            if (!music.paused) { music.pause(); music.currentTime = 0; }
          }
        }

        function togglePhoto() {
          if (!photo.classList.contains('popped')) {
            photo.classList.add('popped');
            body.classList.add('disco');
            // play audio when picture pops out (user gesture - click)
            const tryPlay = music.play();
            if (tryPlay && typeof tryPlay.catch === 'function') tryPlay.catch(() => console.log('Autoplay blocked'));
          } else {
            photo.classList.remove('popped');
            body.classList.remove('disco');
            if (!music.paused) { music.pause(); music.currentTime = 0; }
          }
        }

        outside.addEventListener('click', toggleCard);
        outside.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleCard(); } });

        photo.addEventListener('click', togglePhoto);
      })();
    </script>
  </body>
</html>
